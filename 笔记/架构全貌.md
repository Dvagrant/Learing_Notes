![[MySQL基本架构.png]]

Server 层包括连接器、查询缓存、分析器、优化器、执行器等，涵盖 MySQL 的大多数核心服务功能，以及所有的内置函数（如日期、时间、数学和加密函数等），所有跨存储引擎的功能都在这一层实现，比如存储过程、触发器、视图等。
存储引擎层负责数据的存储和提取。其架构模式是插件式的，支持 InnoDB、MyISAM、Memory 等多个存储引擎。现在最常用的存储引擎是 InnoDB，它从 MySQL 5.5.5 版本开始成为了默认存储引擎。不同的存储引擎共用一个 Server 层。

--- 
## 连接器
连接器负责跟客户端建立连接、获取权限、维持和管理连接。
`mysql -h$ip -P$port -u$user -p`
命令中mysql是客户端工具，用来跟服务端建立链接。完成TCP三次握手之后，连接器开始验证身份，使用的就是用户名和密码。
- 如果用户名或密码不对，你就会收到一个"Access denied for user"的错误，然后客户端程序结束执行。
- 如果用户名密码认证通过，连接器会到权限表里面查出你拥有的权限。之后，这个连接里面的权限判断逻辑，都将依赖于此时读到的权限。

一个用户成功建立连接后，即使你用管理员账号对这个用户的权限做了修改，也不会影响已经存在连接的权限。修改完成后，只有再新建的连接才会使用新的权限设置。

---
## 查询缓存
MySQL 8.0 版本直接将查询缓存的整块功能删掉了，也就是说 8.0 开始彻底没有这个功能了。


- [ ] INSERT BUFFER
- [ ] CHANG BUFFER

---
## 分析器（解析器

生成语法树，检查SQL语法，检查要查询的表（要查询表中不存在的列也在这步报错）
***解析器处理语法和解析查询, 生成一课对应的解析树。
预处理器进一步检查解析树的合法。比如: 数据表和数据列是否存在, 别名是否有歧义等。如果通过则生成新的解析树，再提交给[[## 优化器]]。***

---
## 优化器
根据各种信息来决定索引的使用，
从逻辑执行计划中升成实际执行计划。

---
## 执行器
首先判断权限，如果权限通过则调用引擎接口获取数据。（*在工程实现上，如果命中查询缓存，会在查询缓存返回结果的时候，做权限验证。查询也会在优化器之前调用 precheck 验证权限*）
*** rows_examined：表示这个语句执行过程中扫描了多少行。这个值就是在执行器每次调用引擎获取数据行的时候累加的。在有些场景下，执行器调用一次，在引擎内部则扫描了多行，因此引擎扫描行数跟 rows_examined 并不是完全相同的。***
