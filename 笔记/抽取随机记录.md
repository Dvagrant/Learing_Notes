当需要从某表中随机抽取几条记录时，

## 内存临时表
`select column from table order by rand() limit num`
此语句需要使用临时表，需要排序。
使用的临时表都是内存表，所以排序时无需考虑回表开销，则会优先使用 rowID 排序。
1. 将要排序的字段取出来，并调用 rand() 函数，将<column,rand>存入临时表
2. 将内存临时表中的 rand 值和其行数 rowID 装载进 sort_buffer排序，排好序后通过 rowID 回临时表取出 column

> mysql 5.7中查看慢查询日志，examined_rows显示20003条，说明取内存临时表，也需要过引擎。

## 磁盘临时表
`tmp_table_size`限制了内存临时表的大小，默认16M，超市此值时，会采用磁盘临时表，由`inertnal_tmp_disk_storage_engine`控制引擎，默认InnoDB

## 排序算法
当order by limit 的数量过少时，无需对所有数据排序，仅仅只需取出前 N 条，mysql5.6之后引入的优先队列排序(堆排)可以有效减少排序内存大小。

`OPTIMIZER_TRACE`结果中,`filesort_priority_queue_optimization`这个部分的 chosen=true，就表示使用了优先队列排序算法，这个过程不需要临时文件，因此对应的`number_of_tmp_files`是 0。

---
## 随机排序方法
需要随机取值时，可以直接对表的主键ID取随机值。